id: xml_articles
label: 'Article node migration for local XML source example'
migration_tags:
  - XML Source
  - Nodes
source:
  constants:
    TITLE_SUFFIX: ' (Imported from local file)'

  plugin: url

  # This configuration is ignored by the 'xml' data parser plugin.
  # It only has effect when using the 'simple_xml' data parser plugin.
  data_fetcher_plugin: file

  # Set to 'xml' to use XMLReader https://www.php.net/manual/en/book.xmlreader.php
  # Set to 'simple_xml' to use SimpleXML https://www.php.net/manual/en/ref.simplexml.php
  data_parser_plugin: xml

  urls:
    - modules/custom/custom_migrations/sources/articles.xml

  # XPath expression. It is common that it starts with a slash (/).
  item_selector: /articles/article
  fields:
    - name: src_unique_id
      label: 'Unique ID'
      selector: id
    - name: src_name
      label: 'Title'
      selector: title
    - name: src_description
      label: 'Description'
      selector: description
    - name: src_uid
      label: 'Author'
      selector: user
    - name: src_category
      label: 'Category'
      selector: categories/category
    - name: src_tags
      label: 'Tags'
      selector: tags
  ids:
    src_unique_id:
      type: integer
process:
  title: src_name
  body: src_description
  # uid: src_uid
  uid:
    plugin: migration_lookup
    migration: xml_users
    source: src_uid
  field_article_category:
    plugin: migration_lookup
    migration: xml_categories
    source: src_category
  field_tags:
    - plugin: explode
      delimiter: ','
      source: src_tags
    - plugin: callback
      callable: trim
    - plugin: entity_generate
      entity_type: taxonomy_term
      bundle_key: vid
      bundle: tags
      value_key: name
destination:
  plugin: 'entity:node'
  default_bundle: article
